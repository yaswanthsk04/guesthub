#!/bin/sh /etc/rc.common

START=99
USE_PROCD=1
PROG=/usr/local/monitoring/update-system/update-checker.py
PYTHON=/usr/bin/python3
LOG_FILE=/var/log/update-checker.log

start_service() {
    # Create log file if it doesn't exist and set permissions
    touch $LOG_FILE
    chmod 644 $LOG_FILE
    chown root:root $LOG_FILE

    # Source the environment file first
    . /etc/guesthub-env.sh
    
    procd_open_instance
    procd_set_param command env - GUESTHUB_BRANCH_VERSION="$GUESTHUB_BRANCH_VERSION" GF_SECURITY_ADMIN_USER="$GF_SECURITY_ADMIN_USER" GF_SECURITY_ADMIN_PASSWORD="$GF_SECURITY_ADMIN_PASSWORD" $PYTHON $PROG
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_set_param respawn
    procd_set_param respawn_delay 60
    procd_set_param user root
    procd_set_param group root
    procd_close_instance
}

stop_service() {
    service_stop $PYTHON
}

reload_service() {
    stop
    start
}
